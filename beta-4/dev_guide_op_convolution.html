<!-- HTML header for doxygen 1.8.5-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.9.1"/>
<meta name="viewport" content="width=device-width,initial-scale=1.0">
<title>oneDNN Graph: Convolution</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
  $(document).ready(function() { init_search(); });
/* @license-end */
</script>
<script src="assets/mathjax/MathJax.js?config=TeX-AMS_CHTML,dnnl"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="assets/customdoxygen.css" rel="stylesheet" type="text/css" />
<script type="text/javascript" src="assets/dnn.js"></script>
</head>
<body>
<div class="mobile-nav"><i id="nav-btn"></i><a href="index.html">oneAPI Deep Neural Network Library Graph API (oneDNN Graph)</a></div>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
   <div id="projectname">
     <a href="index.html">
      <div id="full-name">oneAPI Deep Neural Network Library Graph API (oneDNN Graph)</div>
    </a>
   </div>
   <div id="projectbrief">Performance Library for DNN Graph Optimization</div>
   <div id="projectnumber">0.9.0</div>
  <div>        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.svg"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.svg" alt=""/></a>
          </span>
        </div>
</div>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.1 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search','.html');
/* @license-end */
</script>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('dev_guide_op_convolution.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">Convolution </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p><a class="anchor" id="md_doc_operations_Convolution"></a> <a href="https://spec.oneapi.io/onednn-graph/latest/ops/convolution/Convolution_1.html">Convolution definition in oneDNN specification</a></p>
<h1><a class="anchor" id="autotoc_md58"></a>
General</h1>
<p>Convolution op performs the cross correlation between src tensor and weight tensor, which is defined as by the following formulas.</p>
<p>Let \(\src\), \(\weights\) and \(\dst\) tensors have shape \(N \times IC \times IH \times IW\), \(OC \times IC \times KH \times KW\), and \(N \times OC \times OH \times OW\) respectively.</p>
<p>Furthermore, let the remaining convolution parameters be:</p>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadLeft">Parameter   </th><th class="markdownTableHeadLeft">Depth   </th><th class="markdownTableHeadLeft">Height   </th><th class="markdownTableHeadLeft">Width   </th><th class="markdownTableHeadLeft">Comment    </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyLeft">Paddings: Front, top, and left   </td><td class="markdownTableBodyLeft">\(PD_L\)   </td><td class="markdownTableBodyLeft">\(PH_L\)   </td><td class="markdownTableBodyLeft">\(PW_L\)   </td><td class="markdownTableBodyLeft">In the attributes we use <code>pads_begin</code> to indicate the corresponding vector of paddings    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyLeft">Padding: Back, bottom, and right   </td><td class="markdownTableBodyLeft">\(PD_R\)   </td><td class="markdownTableBodyLeft">\(PH_R\)   </td><td class="markdownTableBodyLeft">\(PW_R\)   </td><td class="markdownTableBodyLeft">In the attributes we use <code>pads_end</code> to indicate the corresponding vector of paddings    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyLeft">Stride   </td><td class="markdownTableBodyLeft">\(SD\)   </td><td class="markdownTableBodyLeft">\(SH\)   </td><td class="markdownTableBodyLeft">\(SW\)   </td><td class="markdownTableBodyLeft">In the attributes we use <code>strides</code> to indicate the corresponding vector of strides    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyLeft">Dilation   </td><td class="markdownTableBodyLeft">\(DD\)   </td><td class="markdownTableBodyLeft">\(DH\)   </td><td class="markdownTableBodyLeft">\(DW\)   </td><td class="markdownTableBodyLeft">In the attributes we use <code>dilations</code> to indicate the corresponding vector of dilations   </td></tr>
</table>
<p>To further simplify the formulas, we assume that the attribute <code>data_format</code> and <code>weights_format</code> are set to <code>NCX</code> and <code>OIX</code> respectively. <code>NCX</code> means the fist axis represents batch dimension, the second axis represents channel dimension and the rest represents spatial dimensions. <code>OIX</code> means the first axis represents output channel dimension, the second axis represents input channel dimension and the rest represents weights spatial dimensions.</p>
<h2><a class="anchor" id="autotoc_md59"></a>
Regular Convolution</h2>
<p class="formulaDsp">
\[\dst(n, oc, oh, ow) = \bias(oc) + \sum_{ic=0}^{IC-1}\sum_{kh=0}^{KH-1}\sum_{kw=0}^{KW-1} \src(n, ic, oh \cdot SH + kh - PH_L, ow \cdot SW + kw - PW_L) \cdot \weights(oc, ic, kh, kw).\]
</p>
<p>Here:</p>
<ul>
<li>\(OH = \left\lfloor{\frac{IH - KH + PH_L + PH_R}{SH}} \right\rfloor + 1,\)</li>
<li>\(OW = \left\lfloor{\frac{IW - KW + PW_L + PW_R}{SW}} \right\rfloor + 1.\)</li>
</ul>
<h2><a class="anchor" id="autotoc_md60"></a>
Convolution with group</h2>
<p>The attribute <code>groups</code> is set to \(&gt;1\).</p>
<p class="formulaDsp">
\[ \dst(n, g \cdot OC_G + oc_g, oh, ow) = \bias(g \cdot OC_G + oc_g) \\ + \sum_{ic_g=0}^{IC_G-1}\sum_{kh=0}^{KH-1}\sum_{kw=0}^{KW-1} \src(n, g \cdot IC_G + ic_g, oh \cdot SH + kh - PH_L, ow \cdot SW + kw - PW_L) \cdot \weights(g, oc_g, ic_g, kh, kw), \]
</p>
<p>where</p>
<ul>
<li>\(IC_G = \frac{IC}{G}\),</li>
<li>\(OC_G = \frac{OC}{G}\), and</li>
<li>\(oc_g \in [0, OC_G).\)</li>
</ul>
<h2><a class="anchor" id="autotoc_md61"></a>
Convolution with dilation</h2>
<p>The attribute <code>dilation</code> contains the element which is \(&gt;1\).</p>
<p class="formulaDsp">
\[ \dst(n, oc, oh, ow) = \bias(oc) \\ + \sum_{ic=0}^{IC-1}\sum_{kh=0}^{KH-1}\sum_{kw=0}^{KW-1} \src(n, ic, oh \cdot SH + kh \cdot DH - PH_L, ow \cdot SW + kw \cdot DW - PW_L) \cdot \weights(oc, ic, kh, kw). \]
</p>
<p>Here:</p>
<ul>
<li>\(OH = \left\lfloor{\frac{IH - DKH + PH_L + PH_R}{SH}} \right\rfloor + 1,\) where \(DKH = 1 + (KH - 1) \cdot DH\), and</li>
<li>\(OW = \left\lfloor{\frac{IW - DKW + PW_L + PW_R}{SW}} \right\rfloor + 1,\) where \(DKW = 1 + (KW - 1) \cdot DW\).</li>
</ul>
<h1><a class="anchor" id="autotoc_md62"></a>
Operation Attributes</h1>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">Attribute Name   </th><th class="markdownTableHeadNone">Description   </th><th class="markdownTableHeadNone">Value Type   </th><th class="markdownTableHeadNone">Supported Values   </th><th class="markdownTableHeadNone">Required or Optional    </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><a class="el" href="classdnnl_1_1graph_1_1op.html#ac7650c0c15849338f9c558f53ce82684a3372f3d8ac7d6db0997a8fe6b38d549a">strides</a>   </td><td class="markdownTableBodyNone">controls the strides the filter tensor is moved when computing cross-correlation   </td><td class="markdownTableBodyNone">s64   </td><td class="markdownTableBodyNone">a s64 list containing positive values   </td><td class="markdownTableBodyNone">Required    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone"><a class="el" href="classdnnl_1_1graph_1_1op.html#ac7650c0c15849338f9c558f53ce82684ad9563b69290681059378cb6b98127310">pads_begin</a>   </td><td class="markdownTableBodyNone">controls number of zeros to be add to the front/top/left of spatial dimensions   </td><td class="markdownTableBodyNone">s64   </td><td class="markdownTableBodyNone">a s64 list containing non-negative values   </td><td class="markdownTableBodyNone">Required    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><a class="el" href="classdnnl_1_1graph_1_1op.html#ac7650c0c15849338f9c558f53ce82684ae9dcd3256fd8b6e2b6385091cffe2cd6">pads_end</a>   </td><td class="markdownTableBodyNone">controls number of zeros to be add to the back/bottom/right of spatial dimensions   </td><td class="markdownTableBodyNone">s64   </td><td class="markdownTableBodyNone">a s64 list containing non-negative values   </td><td class="markdownTableBodyNone">Required    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone"><a class="el" href="classdnnl_1_1graph_1_1op.html#ac7650c0c15849338f9c558f53ce82684acbcf9c952f6e423b94fe04593665b49e">dilations</a>   </td><td class="markdownTableBodyNone">controls the amount of stretching the kernel before convolving (<a href="https://github.com/vdumoulin/conv_arithmetic/blob/master/README.md#dilated-convolution-animations">visualization link</a>)   </td><td class="markdownTableBodyNone">s64   </td><td class="markdownTableBodyNone">a s64 list containing positive values (&gt;1 means dilated convolution)   </td><td class="markdownTableBodyNone">Required    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><a class="el" href="classdnnl_1_1graph_1_1op.html#ac7650c0c15849338f9c558f53ce82684a9a6ac749896e044fe3122bd98e44ac9b">auto_pad</a>   </td><td class="markdownTableBodyNone">controls how the padding is calculated   </td><td class="markdownTableBodyNone">string   </td><td class="markdownTableBodyNone"><code>none</code> (default), <code>same_upper</code>, <code>same_lower</code>, <code>valid</code>   </td><td class="markdownTableBodyNone">Optional    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone"><a class="el" href="classdnnl_1_1graph_1_1op.html#ac7650c0c15849338f9c558f53ce82684a1471e4e05a4db95d353cc867fe317314">groups</a>   </td><td class="markdownTableBodyNone">controls how input channels and output channels are divided into   </td><td class="markdownTableBodyNone">s64   </td><td class="markdownTableBodyNone">a positive s64 value, <code>1</code> by default   </td><td class="markdownTableBodyNone">Optional    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><a class="el" href="classdnnl_1_1graph_1_1op.html#ac7650c0c15849338f9c558f53ce82684a4abbd547d2eb3887fd8613bb8be33cc5">data_format</a>   </td><td class="markdownTableBodyNone">controls how to interpret the shape of <code>src</code> and <code>dst</code>.   </td><td class="markdownTableBodyNone">string   </td><td class="markdownTableBodyNone"><code>NCX</code>, <code>NXC</code> (default)   </td><td class="markdownTableBodyNone">Optional    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone"><a class="el" href="classdnnl_1_1graph_1_1op.html#ac7650c0c15849338f9c558f53ce82684a97761cd86aae9f009ce7fcbd17852917">weights_format</a>   </td><td class="markdownTableBodyNone">controls how to interpret the shape of <code>weights</code>   </td><td class="markdownTableBodyNone">string   </td><td class="markdownTableBodyNone"><code>OIX</code>, <code>XIO</code> (default)   </td><td class="markdownTableBodyNone">Optional   </td></tr>
</table>
<h1><a class="anchor" id="autotoc_md63"></a>
Execution Arguments</h1>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">Argument Name   </th><th class="markdownTableHeadNone">Description   </th><th class="markdownTableHeadNone">Required or Optional    </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><code>src</code>   </td><td class="markdownTableBodyNone">input tensor   </td><td class="markdownTableBodyNone">Required    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone"><code>weights</code>   </td><td class="markdownTableBodyNone">weights tensor   </td><td class="markdownTableBodyNone">Required    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><code>bias</code>   </td><td class="markdownTableBodyNone">a 1-D tensor adds to channel dimension of src   </td><td class="markdownTableBodyNone">Optional    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone"><code>dst</code>   </td><td class="markdownTableBodyNone">output tensor   </td><td class="markdownTableBodyNone">Required   </td></tr>
</table>
<dl class="section note"><dt>Note</dt><dd>The shape of weights is \((out\_channels, in\_channels / groups, spatial\_shape)\) for <code>OIX</code> format or \((spatial\_shape, in\_channels / groups, out\_channels)\) for <code>XIO</code> format. Both \(in\_channels\) and \(out\_channels\) must be divisible by <em>groups</em> attribute.</dd></dl>
<h1><a class="anchor" id="autotoc_md64"></a>
Supported Data Types</h1>
<p>Convolution op supports the following data types.</p>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">Src   </th><th class="markdownTableHeadNone">Weights   </th><th class="markdownTableHeadNone">Bias   </th><th class="markdownTableHeadNone">Dst    </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">f32   </td><td class="markdownTableBodyNone">f32   </td><td class="markdownTableBodyNone">f32   </td><td class="markdownTableBodyNone">f32    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">bf16   </td><td class="markdownTableBodyNone">bf16   </td><td class="markdownTableBodyNone">bf16   </td><td class="markdownTableBodyNone">bf16    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">f16   </td><td class="markdownTableBodyNone">f16   </td><td class="markdownTableBodyNone">f16   </td><td class="markdownTableBodyNone">f16   </td></tr>
</table>
</div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<div class="footer">
    <script>
        $('#top').prependTo($('#side-nav'));
    </script>
    <div class="footer-wrapper">
        <hr>
        <ul class="footer-links">
            <li><a href="legal_information.html">Legal information</a></li>
        </ul>
    </div>
</div>