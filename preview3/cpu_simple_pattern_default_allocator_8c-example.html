<!-- HTML header for doxygen 1.8.5-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.9.1"/>
<meta name="viewport" content="width=device-width,initial-scale=1.0">
<title>oneDNN Graph: cpu_simple_pattern_default_allocator.c</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
  $(document).ready(function() { init_search(); });
/* @license-end */
</script>
<script src="assets/mathjax/MathJax.js?config=TeX-AMS_CHTML,dnnl"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="assets/customdoxygen.css" rel="stylesheet" type="text/css" />
<script type="text/javascript" src="assets/dnn.js"></script>
</head>
<body>
<div class="mobile-nav"><i id="nav-btn"></i><a href="index.html">oneAPI Deep Neural Network Library Graph API (oneDNN Graph)</a></div>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
   <div id="projectname">
     <a href="index.html">
      <div id="full-name">oneAPI Deep Neural Network Library Graph API (oneDNN Graph)</div>
    </a>
   </div>
   <div id="projectbrief">Performance Library for DNN Graph Optimization</div>
   <div id="projectnumber">0.3.0</div>
  <div>        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.svg"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.svg" alt=""/></a>
          </span>
        </div>
</div>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.1 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search','.html');
/* @license-end */
</script>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('cpu_simple_pattern_default_allocator_8c-example.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">cpu_simple_pattern_default_allocator.c</div>  </div>
</div><!--header-->
<div class="contents">
<blockquote class="doxtable">
<p>Example code: <a class="el" href="cpu_simple_pattern_default_allocator_8c-example.html">cpu_simple_pattern_default_allocator.c</a> </p>
</blockquote>
<blockquote class="doxtable">
<p>Annotated version: <a class="el" href="cpu_simple_pattern_default_allocator_c.html">A CPU example for conv+relu+conv+relu pattern</a> </p>
</blockquote>
<div class="fragment"><div class="line"><span class="comment">/*******************************************************************************</span></div>
<div class="line"><span class="comment">* Copyright 2020-2021 Intel Corporation</span></div>
<div class="line"><span class="comment">*</span></div>
<div class="line"><span class="comment">* Licensed under the Apache License, Version 2.0 (the &quot;License&quot;);</span></div>
<div class="line"><span class="comment">* you may not use this file except in compliance with the License.</span></div>
<div class="line"><span class="comment">* You may obtain a copy of the License at</span></div>
<div class="line"><span class="comment">*</span></div>
<div class="line"><span class="comment">*     http://www.apache.org/licenses/LICENSE-2.0</span></div>
<div class="line"><span class="comment">*</span></div>
<div class="line"><span class="comment">* Unless required by applicable law or agreed to in writing, software</span></div>
<div class="line"><span class="comment">* distributed under the License is distributed on an &quot;AS IS&quot; BASIS,</span></div>
<div class="line"><span class="comment">* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.</span></div>
<div class="line"><span class="comment">* See the License for the specific language governing permissions and</span></div>
<div class="line"><span class="comment">* limitations under the License.</span></div>
<div class="line"><span class="comment">*******************************************************************************/</span></div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#include &lt;assert.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;stdio.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;stdlib.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;string.h&gt;</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#include &quot;common/allocator.h&quot;</span></div>
<div class="line"><span class="preprocessor">#include &quot;common/graph.h&quot;</span></div>
<div class="line"><span class="preprocessor">#include &quot;common/op.h&quot;</span></div>
<div class="line"><span class="preprocessor">#include &quot;common/op_def.h&quot;</span></div>
<div class="line"><span class="preprocessor">#include &quot;common/tensor.h&quot;</span></div>
<div class="line"><span class="preprocessor">#include &quot;common/utils.h&quot;</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#include &quot;<a class="code" href="dnnl__graph_8h.html">oneapi/dnnl/dnnl_graph.h</a>&quot;</span></div>
<div class="line"> </div>
<div class="line"><span class="keyword">typedef</span> <span class="keyword">struct </span>{</div>
<div class="line">    example_op_t *example_op_;</div>
<div class="line">    dnnl_graph_op_t *dnnl_graph_op_;</div>
<div class="line">} op_map;</div>
<div class="line"> </div>
<div class="line"><span class="keyword">typedef</span> <span class="keyword">struct </span>{</div>
<div class="line">    example_op_t *e_op_;</div>
<div class="line">    dnnl_graph_partition_t *l_p_;</div>
<div class="line">    dnnl_graph_compiled_partition_t *l_cp_;</div>
<div class="line"> </div>
<div class="line">} partition_map;</div>
<div class="line"> </div>
<div class="line">op_map o_map[100];</div>
<div class="line">int64_t o_map_num = 0;</div>
<div class="line"> </div>
<div class="line">partition_map p_map[100];</div>
<div class="line">int64_t p_map_num = 0;</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">void</span> op_map_add(example_op_t *e_op, dnnl_graph_op_t *l_op) {</div>
<div class="line">    o_map[o_map_num].example_op_ = e_op;</div>
<div class="line">    o_map[o_map_num].dnnl_graph_op_ = l_op;</div>
<div class="line">    o_map_num++;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line">example_result_t find_example_op_by_dnnl_graph_op_id(</div>
<div class="line">        example_op_t **op, <span class="keywordtype">size_t</span> lp_id) {</div>
<div class="line">    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> k = 0; k &lt; o_map_num; k++) {</div>
<div class="line">        <span class="keywordtype">size_t</span> temp_id;</div>
<div class="line">        DNNL_GRAPH_CHECK(</div>
<div class="line">                <a name="a0"></a><a class="code" href="group__dnnl__graph__api__op.html#ga057fa366160206d52e4dbd05443a8b01">dnnl_graph_op_get_id</a>(o_map[k].dnnl_graph_op_, &amp;temp_id));</div>
<div class="line">        <span class="keywordflow">if</span> (temp_id == lp_id) {</div>
<div class="line">            *op = o_map[k].example_op_;</div>
<div class="line">            <span class="keywordflow">if</span> (*op == NULL) <span class="keywordflow">return</span> example_result_error_common_fail;</div>
<div class="line">            <span class="keywordflow">return</span> example_result_success;</div>
<div class="line">        }</div>
<div class="line">    }</div>
<div class="line">    <span class="keywordflow">return</span> example_result_error_common_fail;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">void</span> partition_map_add(example_op_t *e_op, dnnl_graph_partition_t *l_p) {</div>
<div class="line">    p_map[p_map_num].e_op_ = e_op;</div>
<div class="line">    p_map[p_map_num].l_p_ = l_p;</div>
<div class="line">    p_map[p_map_num].l_cp_ = NULL;</div>
<div class="line">    p_map_num++;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line">int64_t find_by_dnnl_graph_partition(dnnl_graph_partition_t *l_p) {</div>
<div class="line">    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> k = 0; k &lt; p_map_num; k++) {</div>
<div class="line">        <span class="keywordflow">if</span> (l_p == p_map[k].l_p_) { <span class="keywordflow">return</span> k; }</div>
<div class="line">    }</div>
<div class="line">    <span class="keywordflow">return</span> -1;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line">int64_t find_by_example_op(example_op_t *e_op) {</div>
<div class="line">    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> k = 0; k &lt; p_map_num; k++) {</div>
<div class="line">        <span class="keywordflow">if</span> (e_op == p_map[k].e_op_) { <span class="keywordflow">return</span> k; }</div>
<div class="line">    }</div>
<div class="line">    <span class="keywordflow">return</span> -1;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line">example_result_t create_simple_pattern_graph(</div>
<div class="line">        example_graph_t **graph, example_tensor_t *input) {</div>
<div class="line">    CHECK_EXAMPLE(example_graph_create(graph));</div>
<div class="line"> </div>
<div class="line">    example_tensor_t *net = NULL;</div>
<div class="line">    net = createConv2d(*graph, <span class="stringliteral">&quot;conv_0&quot;</span>, input, 96, 11, 4, 0, 1, 1);</div>
<div class="line">    net = createRelu(*graph, <span class="stringliteral">&quot;relu_0&quot;</span>, net);</div>
<div class="line">    net = createConv2d(*graph, <span class="stringliteral">&quot;conv_1&quot;</span>, net, 96, 3, 1, 0, 1, 1);</div>
<div class="line">    net = createRelu(*graph, <span class="stringliteral">&quot;relu_1&quot;</span>, net);</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">if</span> (net == NULL) <span class="keywordflow">return</span> example_result_error_common_fail;</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">return</span> example_result_success;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line">dnnl_graph_op_t *convert_op(example_op_t *e_op) {</div>
<div class="line">    dnnl_graph_op_t *l_op = NULL;</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// dispatch to different op kind</span></div>
<div class="line">    <span class="keywordflow">if</span> (e_op-&gt;kind_ == e_kconv2d) {</div>
<div class="line">        DNNL_GRAPH_CHECK(<a name="a1"></a><a class="code" href="group__dnnl__graph__api__op.html#gaa04492222b1da2e74ed6c8e0e13d7ea3">dnnl_graph_op_create</a>(</div>
<div class="line">                &amp;l_op, e_op-&gt;id_, kConvolution, e_op-&gt;name_));</div>
<div class="line">    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (e_op-&gt;kind_ == e_krelu) {</div>
<div class="line">        DNNL_GRAPH_CHECK(</div>
<div class="line">                <a class="code" href="group__dnnl__graph__api__op.html#gaa04492222b1da2e74ed6c8e0e13d7ea3">dnnl_graph_op_create</a>(&amp;l_op, e_op-&gt;id_, kReLU, e_op-&gt;name_));</div>
<div class="line">    } <span class="keywordflow">else</span> {</div>
<div class="line">        <span class="comment">// TODO(qun) support more op kind</span></div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// add op attrs</span></div>
<div class="line">    <span class="keywordflow">if</span> (l_op != NULL) {</div>
<div class="line">        <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; e_op-&gt;attrs_num_; i++) {</div>
<div class="line">            example_attr_t *attr = e_op-&gt;attrs_[i];</div>
<div class="line">            DNNL_GRAPH_CHECK(<a name="a2"></a><a class="code" href="group__dnnl__graph__api__op.html#ga862fb0704b7712f99ec60d7a9c4a70ac">dnnl_graph_op_add_attr</a>(l_op, attr-&gt;name_,</div>
<div class="line">                    (<a class="code" href="group__dnnl__graph__api__op.html#ga56fcbd336ee8259ef768a78ac21387ef">dnnl_graph_attribute_kind_t</a>)attr-&gt;kind_, attr-&gt;data_,</div>
<div class="line">                    attr-&gt;data_num_));</div>
<div class="line">        }</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">return</span> l_op;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">int</span> main(<span class="keywordtype">int</span> argc, <span class="keywordtype">char</span> **argv) {</div>
<div class="line">    <span class="comment">// Get input args</span></div>
<div class="line">    <a class="code" href="group__dnnl__graph__api__engine.html#ga6ac1ba87052e33099253f1d21ddd0091">dnnl_graph_engine_kind_t</a> engine_kind = parse_engine_kind(argc, argv);</div>
<div class="line">    <span class="keywordflow">if</span> (engine_kind == <a name="a3"></a><a class="code" href="group__dnnl__graph__api__engine.html#gga6ac1ba87052e33099253f1d21ddd0091a0e4015e41880cfeee945c30cbf346da2">dnnl_graph_gpu</a>) {</div>
<div class="line">        printf(<span class="stringliteral">&quot;Don&#39;t support gpu now\n&quot;</span>);</div>
<div class="line">        <span class="keywordflow">return</span> -1;</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="comment">/*</span></div>
<div class="line"><span class="comment">     * Part 1:</span></div>
<div class="line"><span class="comment">     * We construct a graph in example level, which simulates the framework graph.</span></div>
<div class="line"><span class="comment">     */</span></div>
<div class="line"> </div>
<div class="line">    <span class="comment">// Step 1: create example input tensor</span></div>
<div class="line">    int64_t input_dims[] = {8, 3, 227, 227};</div>
<div class="line"> </div>
<div class="line">    example_tensor_t *example_input = NULL;</div>
<div class="line">    CHECK_EXAMPLE(</div>
<div class="line">            example_tensor_create(&amp;example_input, f32, 4, input_dims, any));</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// Step 2: construct a example graph</span></div>
<div class="line">    example_graph_t *example_graph = NULL;</div>
<div class="line">    CHECK_EXAMPLE(create_simple_pattern_graph(&amp;example_graph, example_input));</div>
<div class="line"> </div>
<div class="line">    <span class="comment">/*</span></div>
<div class="line"><span class="comment">     * Part 2:</span></div>
<div class="line"><span class="comment">     * We show how to use dnnl graph to optimize the example graph, and run it.</span></div>
<div class="line"><span class="comment">     */</span></div>
<div class="line"> </div>
<div class="line">    <span class="comment">// Step 1: create an engine and set the allocator to it,</span></div>
<div class="line">    <span class="comment">// the engine and allocator will used by dnnl graph backend to manage memory resource</span></div>
<div class="line">    printf(<span class="stringliteral">&quot;Step 1: Create engine-------------------&quot;</span>);</div>
<div class="line">    dnnl_graph_engine_t *engine = NULL;</div>
<div class="line">    int32_t device_id = 0;</div>
<div class="line">    DNNL_GRAPH_CHECK(<a name="a4"></a><a class="code" href="group__dnnl__graph__api__engine.html#gaffbc76b0e5aaa1683475940224c7da2b">dnnl_graph_engine_create</a>(&amp;engine, engine_kind, device_id));</div>
<div class="line">    printf(<span class="stringliteral">&quot;Success!\n&quot;</span>);</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// Step 2: traverse the example graph, convert each op to</span></div>
<div class="line">    <span class="comment">// dnnl graph op, create corresponding logical tensor edge and</span></div>
<div class="line">    <span class="comment">// then add supported ops into the graph</span></div>
<div class="line">    printf(<span class="stringliteral">&quot;Step 2: Add OP to graph-----------------&quot;</span>);</div>
<div class="line">    dnnl_graph_graph_t *graph = NULL;</div>
<div class="line">    DNNL_GRAPH_CHECK(<a name="a5"></a><a class="code" href="group__dnnl__graph__api__graph.html#gadfe53f5827f6a1b22c6a3d379b229af9">dnnl_graph_graph_create</a>(&amp;graph, engine_kind));</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; example_graph-&gt;op_num_; i++) {</div>
<div class="line">        example_op_t *e_op = example_graph-&gt;ops_[i];</div>
<div class="line"> </div>
<div class="line">        <span class="comment">// convert example op to dnnl graph op and merge attrs</span></div>
<div class="line">        dnnl_graph_op_t *l_op = convert_op(e_op);</div>
<div class="line">        <span class="keywordflow">if</span> (l_op == NULL) {</div>
<div class="line">            example_graph_destroy(example_graph);</div>
<div class="line">            example_tensor_destroy_all();</div>
<div class="line">            DNNL_GRAPH_CHECK(<a name="a6"></a><a class="code" href="group__dnnl__graph__api__graph.html#ga81b728dd786b54ad00ae27c653fda997">dnnl_graph_graph_destroy</a>(graph));</div>
<div class="line">            DNNL_GRAPH_CHECK(<a name="a7"></a><a class="code" href="group__dnnl__graph__api__engine.html#ga902b3342c537e89283590657ab2b532d">dnnl_graph_engine_destroy</a>(engine));</div>
<div class="line">            <span class="keywordflow">return</span> -1;</div>
<div class="line">        }</div>
<div class="line">        op_map_add(e_op, l_op);</div>
<div class="line"> </div>
<div class="line">        <span class="comment">// add in/outputs</span></div>
<div class="line">        <span class="keywordflow">for</span> (<span class="keywordtype">int</span> j = 0; j &lt; e_op-&gt;inputs_num_; j++) {</div>
<div class="line">            example_tensor_t *e_t = e_op-&gt;inputs_[j];</div>
<div class="line"> </div>
<div class="line">            <span class="comment">// create a logical tensor to represent edge according</span></div>
<div class="line">            <span class="comment">// to example.</span></div>
<div class="line">            <a name="_a8"></a><a class="code" href="structdnnl__graph__logical__tensor__t.html">dnnl_graph_logical_tensor_t</a> l_lt;</div>
<div class="line">            DNNL_GRAPH_CHECK(<a name="a9"></a><a class="code" href="group__dnnl__graph__api__logical__tensor.html#gad2c645ad00ecc288a830d19cae78dcec">dnnl_graph_logical_tensor_init_with_dims</a>(&amp;l_lt,</div>
<div class="line">                    e_t-&gt;id_, (<a class="code" href="group__dnnl__graph__api__logical__tensor.html#gaad147cf0f6df4b97b1c4a55b5595128b">dnnl_graph_data_type_t</a>)e_t-&gt;dtype_, e_t-&gt;ndims_,</div>
<div class="line">                    e_t-&gt;dims_, <a name="a10"></a><a class="code" href="group__dnnl__graph__api__logical__tensor.html#gga5b552d8a81835eb955253410bf012694afc5178ef75924c4f130c70cf7b223203">dnnl_graph_layout_type_any</a>,</div>
<div class="line">                    <a name="a11"></a><a class="code" href="group__dnnl__graph__api__logical__tensor.html#ggadf98ec2238dd9001c6fe7870ebf1b19faa02e5493848853a9bf77982d2fa56ab7">dnnl_graph_tensor_property_undef</a>));</div>
<div class="line">            DNNL_GRAPH_CHECK(</div>
<div class="line">                    <a name="a12"></a><a class="code" href="group__dnnl__graph__api__op.html#gac4e6257c11f83655f5a75dd538f16938">dnnl_graph_op_add_input</a>(l_op, &amp;l_lt)); <span class="comment">// value copy</span></div>
<div class="line">        }</div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">for</span> (<span class="keywordtype">int</span> j = 0; j &lt; e_op-&gt;outputs_num_; j++) {</div>
<div class="line">            example_tensor_t *e_t = e_op-&gt;outputs_[j];</div>
<div class="line">            <a class="code" href="structdnnl__graph__logical__tensor__t.html">dnnl_graph_logical_tensor_t</a> l_lt;</div>
<div class="line">            DNNL_GRAPH_CHECK(<a class="code" href="group__dnnl__graph__api__logical__tensor.html#gad2c645ad00ecc288a830d19cae78dcec">dnnl_graph_logical_tensor_init_with_dims</a>(&amp;l_lt,</div>
<div class="line">                    e_t-&gt;id_, (<a class="code" href="group__dnnl__graph__api__logical__tensor.html#gaad147cf0f6df4b97b1c4a55b5595128b">dnnl_graph_data_type_t</a>)e_t-&gt;dtype_, e_t-&gt;ndims_,</div>
<div class="line">                    e_t-&gt;dims_, <a class="code" href="group__dnnl__graph__api__logical__tensor.html#gga5b552d8a81835eb955253410bf012694afc5178ef75924c4f130c70cf7b223203">dnnl_graph_layout_type_any</a>,</div>
<div class="line">                    <a class="code" href="group__dnnl__graph__api__logical__tensor.html#ggadf98ec2238dd9001c6fe7870ebf1b19faa02e5493848853a9bf77982d2fa56ab7">dnnl_graph_tensor_property_undef</a>));</div>
<div class="line">            DNNL_GRAPH_CHECK(<a name="a13"></a><a class="code" href="group__dnnl__graph__api__op.html#gaf57b836c94bc9974da2da67a0a68baf2">dnnl_graph_op_add_output</a>(l_op, &amp;l_lt));</div>
<div class="line">        }</div>
<div class="line"> </div>
<div class="line">        <span class="comment">// add the op into a graph (internal graph)</span></div>
<div class="line">        DNNL_GRAPH_CHECK(<a name="a14"></a><a class="code" href="group__dnnl__graph__api__graph.html#ga46e3946d6079590f03205f660be1b5fe">dnnl_graph_add_op</a>(graph, l_op));</div>
<div class="line">    }</div>
<div class="line">    printf(<span class="stringliteral">&quot;Success!\n&quot;</span>);</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// Step 3: filter and get partition</span></div>
<div class="line">    <span class="comment">// Run pass to optimize the added graph. this will fuse some op into</span></div>
<div class="line">    <span class="comment">// one fused op, so the graph will be rewrited after this process</span></div>
<div class="line">    printf(<span class="stringliteral">&quot;Step 3: Filter and get partition--------&quot;</span>);</div>
<div class="line">    DNNL_GRAPH_CHECK(</div>
<div class="line">            <a name="a15"></a><a class="code" href="group__dnnl__graph__api__graph.html#ga27e4c096e75702ef2a885c2cecd64d12">dnnl_graph_graph_filter</a>(graph, <a name="a16"></a><a class="code" href="group__dnnl__graph__api__partition.html#gga7e24b277b64600ef3a83dac2e8dfa83ba1489f3f9bb1262b58fa0bf0524d883a4">dnnl_graph_partition_policy_fusion</a>));</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// Get partition from the optimized graph. Each partition will be composed</span></div>
<div class="line">    <span class="comment">// of a single op (fused or unfused op)</span></div>
<div class="line">    uint64_t partitions_num;</div>
<div class="line">    DNNL_GRAPH_CHECK(</div>
<div class="line">            <a name="a17"></a><a class="code" href="group__dnnl__graph__api__graph.html#gab0799273b35e51deb13ebaf510124a8b">dnnl_graph_graph_get_partition_num</a>(graph, &amp;partitions_num));</div>
<div class="line">    <span class="keywordflow">if</span> (partitions_num != 2) {</div>
<div class="line">        printf(<span class="stringliteral">&quot;Error: partitions number is not equal to %llu\n&quot;</span>,</div>
<div class="line">                (<span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> <span class="keywordtype">long</span>)partitions_num);</div>
<div class="line">        example_graph_destroy(example_graph);</div>
<div class="line">        example_tensor_destroy_all();</div>
<div class="line">        DNNL_GRAPH_CHECK(<a class="code" href="group__dnnl__graph__api__graph.html#ga81b728dd786b54ad00ae27c653fda997">dnnl_graph_graph_destroy</a>(graph));</div>
<div class="line">        DNNL_GRAPH_CHECK(<a class="code" href="group__dnnl__graph__api__engine.html#ga902b3342c537e89283590657ab2b532d">dnnl_graph_engine_destroy</a>(engine));</div>
<div class="line">        <span class="keywordflow">return</span> -1;</div>
<div class="line">    }</div>
<div class="line">    dnnl_graph_partition_t *partitions[2];</div>
<div class="line">    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; partitions_num; i++) {</div>
<div class="line">        DNNL_GRAPH_CHECK(<a name="a18"></a><a class="code" href="group__dnnl__graph__api__partition.html#gabdd1e8735d0f2f72165da4c2458121e0">dnnl_graph_partition_create</a>(&amp;partitions[i]));</div>
<div class="line">    }</div>
<div class="line">    DNNL_GRAPH_CHECK(</div>
<div class="line">            <a name="a19"></a><a class="code" href="group__dnnl__graph__api__graph.html#gaf5c2c8684ac48acc413fb9cfbe699c60">dnnl_graph_graph_get_partitions</a>(graph, partitions_num, partitions));</div>
<div class="line">    printf(<span class="stringliteral">&quot;Success!\n&quot;</span>);</div>
<div class="line">    printf(<span class="stringliteral">&quot;Partition number: %llu\n&quot;</span>, (<span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> <span class="keywordtype">long</span>)partitions_num);</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// Step 4: rewrite the example graph</span></div>
<div class="line">    <span class="comment">// replace the example graph&#39;s op with fake op, which will be bind to a</span></div>
<div class="line">    <span class="comment">// partition and run by dnnl graph in execution</span></div>
<div class="line">    printf(<span class="stringliteral">&quot;Step 4: Rewrite the example graph-------&quot;</span>);</div>
<div class="line">    int64_t unoptimized_graph_op_num = example_graph-&gt;op_num_;</div>
<div class="line">    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; partitions_num; i++) {</div>
<div class="line">        <span class="comment">// create a fake op to represent the partition in example graph</span></div>
<div class="line">        <span class="comment">// and cache the map between fake op and partition</span></div>
<div class="line">        example_op_t *e_op_fake = NULL;</div>
<div class="line">        CHECK_EXAMPLE(example_op_create_base(</div>
<div class="line">                &amp;e_op_fake, <span class="stringliteral">&quot;DNNL_GRAPH_EXE_OP&quot;</span>, e_kfake));</div>
<div class="line">        partition_map_add(e_op_fake, partitions[i]);</div>
<div class="line"> </div>
<div class="line">        <span class="comment">// get partition&#39;s op</span></div>
<div class="line">        <span class="keywordtype">size_t</span> ops_num;</div>
<div class="line">        DNNL_GRAPH_CHECK(</div>
<div class="line">                <a name="a20"></a><a class="code" href="group__dnnl__graph__api__partition.html#gae377c7c97821f6ee0f30fe629ba30d88">dnnl_graph_partition_get_op_num</a>(partitions[i], &amp;ops_num));</div>
<div class="line">        <span class="keywordtype">size_t</span> partition_ops_ids[2];</div>
<div class="line">        DNNL_GRAPH_CHECK(<a name="a21"></a><a class="code" href="group__dnnl__graph__api__partition.html#ga35581ae03ac8606c1bcb52e4c6ee8d8a">dnnl_graph_partition_get_ops</a>(</div>
<div class="line">                partitions[i], ops_num, partition_ops_ids));</div>
<div class="line"> </div>
<div class="line">        <span class="comment">// for every op_id in partition, we need to find the corresponding example</span></div>
<div class="line">        <span class="comment">// op, cut off its connection in the example graph and re-connect its inputs</span></div>
<div class="line">        <span class="comment">// and outputs to the new fake op.</span></div>
<div class="line">        <span class="keywordflow">for</span> (<span class="keywordtype">int</span> j = 0; j &lt; ops_num; j++) {</div>
<div class="line">            example_op_t *e_op_erase;</div>
<div class="line">            CHECK_EXAMPLE(find_example_op_by_dnnl_graph_op_id(</div>
<div class="line">                    &amp;e_op_erase, partition_ops_ids[j]));</div>
<div class="line"> </div>
<div class="line">            <span class="keywordflow">for</span> (<span class="keywordtype">int</span> k = 0; k &lt; e_op_erase-&gt;inputs_num_; k++) {</div>
<div class="line">                example_tensor_t *input = e_op_erase-&gt;inputs_[k];</div>
<div class="line">                CHECK_EXAMPLE(example_tensor_erase_user(input, e_op_erase));</div>
<div class="line"> </div>
<div class="line">                e_op_fake-&gt;inputs_[e_op_fake-&gt;inputs_num_] = input;</div>
<div class="line">                CHECK_EXAMPLE(example_tensor_add_user(</div>
<div class="line">                        input, e_op_fake, e_op_fake-&gt;inputs_num_));</div>
<div class="line">                e_op_fake-&gt;inputs_num_++;</div>
<div class="line">            }</div>
<div class="line"> </div>
<div class="line">            <span class="keywordflow">for</span> (<span class="keywordtype">int</span> k = 0; k &lt; e_op_erase-&gt;outputs_num_; k++) {</div>
<div class="line">                example_tensor_t *output = e_op_erase-&gt;outputs_[k];</div>
<div class="line">                CHECK_EXAMPLE(</div>
<div class="line">                        example_tensor_erase_producer(output, e_op_erase));</div>
<div class="line"> </div>
<div class="line">                e_op_fake-&gt;outputs_[e_op_fake-&gt;outputs_num_] = output;</div>
<div class="line">                CHECK_EXAMPLE(example_tensor_set_producer(</div>
<div class="line">                        output, e_op_fake, e_op_fake-&gt;outputs_num_));</div>
<div class="line">                e_op_fake-&gt;outputs_num_++;</div>
<div class="line">            }</div>
<div class="line">        }</div>
<div class="line"> </div>
<div class="line">        <span class="comment">// add the new fake op to example graph, and destroy the fused op</span></div>
<div class="line">        int32_t do_replace = 1;</div>
<div class="line">        <span class="keywordflow">for</span> (int64_t j = example_graph-&gt;op_num_ - 1; j &gt;= 0; j--) {</div>
<div class="line">            int32_t found = 0;</div>
<div class="line"> </div>
<div class="line">            <span class="keywordflow">for</span> (<span class="keywordtype">int</span> k = 0; k &lt; ops_num; k++) {</div>
<div class="line">                example_op_t *e_op_erase;</div>
<div class="line">                CHECK_EXAMPLE(find_example_op_by_dnnl_graph_op_id(</div>
<div class="line">                        &amp;e_op_erase, partition_ops_ids[k]));</div>
<div class="line">                <span class="keywordflow">if</span> (example_graph-&gt;ops_[j] == e_op_erase) {</div>
<div class="line">                    found = 1;</div>
<div class="line">                    <span class="keywordflow">break</span>;</div>
<div class="line">                }</div>
<div class="line">            }</div>
<div class="line"> </div>
<div class="line">            <span class="keywordflow">if</span> (!found) <span class="keywordflow">continue</span>;</div>
<div class="line"> </div>
<div class="line">            example_op_destroy(example_graph-&gt;ops_[j]);</div>
<div class="line"> </div>
<div class="line">            <span class="comment">// we replace the first found fused op with the fake op</span></div>
<div class="line">            <span class="keywordflow">if</span> (do_replace) {</div>
<div class="line">                example_graph-&gt;ops_[j] = e_op_fake;</div>
<div class="line">                do_replace = 0;</div>
<div class="line">                <span class="keywordflow">continue</span>;</div>
<div class="line">            }</div>
<div class="line"> </div>
<div class="line">            <span class="comment">// just erase the non-first found fused op</span></div>
<div class="line">            <span class="keywordflow">for</span> (int64_t k = j; k &lt; example_graph-&gt;op_num_ - 1; k++) {</div>
<div class="line">                example_graph-&gt;ops_[k] = example_graph-&gt;ops_[k + 1];</div>
<div class="line">            }</div>
<div class="line">            example_graph-&gt;op_num_--;</div>
<div class="line">        }</div>
<div class="line"> </div>
<div class="line">    } <span class="comment">// for (int i = 0; i &lt; partitions_num; i++)</span></div>
<div class="line">    printf(<span class="stringliteral">&quot;Success!\n&quot;</span>);</div>
<div class="line">    printf(<span class="stringliteral">&quot;Op num in unoptimized graph: %lld\n&quot;</span>,</div>
<div class="line">            (<span class="keywordtype">long</span> <span class="keywordtype">long</span> <span class="keywordtype">int</span>)unoptimized_graph_op_num);</div>
<div class="line">    printf(<span class="stringliteral">&quot;Op num in optimized graph: %lld\n&quot;</span>,</div>
<div class="line">            (<span class="keywordtype">long</span> <span class="keywordtype">long</span> <span class="keywordtype">int</span>)example_graph-&gt;op_num_);</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// Step 5: compile the partitions</span></div>
<div class="line">    <span class="comment">// do layout propagation and mount backend&#39;s execution kernel</span></div>
<div class="line">    printf(<span class="stringliteral">&quot;Step 5: Compile the partitions----------&quot;</span>);</div>
<div class="line">    dnnl_graph_compiled_partition_t *compiled_partitions[2];</div>
<div class="line">    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; partitions_num; i++) {</div>
<div class="line">        <span class="comment">// we find the corresponding fake op in example graph, create</span></div>
<div class="line">        <span class="comment">// logical tensor according to its inputs and outputs example</span></div>
<div class="line">        <span class="comment">// tensor.</span></div>
<div class="line">        int64_t idx = find_by_dnnl_graph_partition(partitions[i]);</div>
<div class="line">        example_op_t *e_op = p_map[idx].e_op_;</div>
<div class="line"> </div>
<div class="line">        DNNL_GRAPH_CHECK(<a name="a22"></a><a class="code" href="group__dnnl__graph__api__compiled__partition.html#ga6195715f5461f59b5f7e0b81c94d8ad6">dnnl_graph_compiled_partition_create</a>(</div>
<div class="line">                &amp;compiled_partitions[i], partitions[i]));</div>
<div class="line">        p_map[idx].l_cp_ = compiled_partitions[i];</div>
<div class="line"> </div>
<div class="line">        <a class="code" href="structdnnl__graph__logical__tensor__t.html">dnnl_graph_logical_tensor_t</a> l_lts_in[3];</div>
<div class="line">        <span class="keywordflow">for</span> (<span class="keywordtype">int</span> j = 0; j &lt; e_op-&gt;inputs_num_; j++) {</div>
<div class="line">            example_tensor_t *e_t = e_op-&gt;inputs_[j];</div>
<div class="line"> </div>
<div class="line">            <span class="keywordflow">if</span> (!e_t-&gt;producer_.producer_) {</div>
<div class="line">                <span class="comment">// this is the graph&#39;s input, we set the layout id to plain</span></div>
<div class="line">                DNNL_GRAPH_CHECK(<a class="code" href="group__dnnl__graph__api__logical__tensor.html#gad2c645ad00ecc288a830d19cae78dcec">dnnl_graph_logical_tensor_init_with_dims</a>(</div>
<div class="line">                        l_lts_in + j, e_t-&gt;id_,</div>
<div class="line">                        (<a class="code" href="group__dnnl__graph__api__logical__tensor.html#gaad147cf0f6df4b97b1c4a55b5595128b">dnnl_graph_data_type_t</a>)e_t-&gt;dtype_, e_t-&gt;ndims_,</div>
<div class="line">                        e_t-&gt;dims_, <a name="a23"></a><a class="code" href="group__dnnl__graph__api__logical__tensor.html#gga5b552d8a81835eb955253410bf012694aa9ea14026cc47aafffdcb92c00a1b1ea">dnnl_graph_layout_type_strided</a>,</div>
<div class="line">                        <a class="code" href="group__dnnl__graph__api__logical__tensor.html#ggadf98ec2238dd9001c6fe7870ebf1b19faa02e5493848853a9bf77982d2fa56ab7">dnnl_graph_tensor_property_undef</a>));</div>
<div class="line"> </div>
<div class="line">            } <span class="keywordflow">else</span> {</div>
<div class="line">                <span class="comment">// we need to query logical tensor id from the producer compiled partition</span></div>
<div class="line">                int64_t temp_idx = find_by_example_op(e_t-&gt;producer_.producer_);</div>
<div class="line">                dnnl_graph_compiled_partition_t *l_cp = p_map[temp_idx].l_cp_;</div>
<div class="line">                DNNL_GRAPH_CHECK(</div>
<div class="line">                        <a name="a24"></a><a class="code" href="group__dnnl__graph__api__compiled__partition.html#gabb66f2bd97e30ee1578449f4b2f90fe9">dnnl_graph_compiled_partition_query_logical_tensor</a>(</div>
<div class="line">                                l_cp, e_t-&gt;id_, l_lts_in + j));</div>
<div class="line">            }</div>
<div class="line">        }</div>
<div class="line"> </div>
<div class="line">        <a class="code" href="structdnnl__graph__logical__tensor__t.html">dnnl_graph_logical_tensor_t</a> l_lts_out[2];</div>
<div class="line">        <span class="keywordflow">for</span> (<span class="keywordtype">int</span> j = 0; j &lt; e_op-&gt;outputs_num_; j++) {</div>
<div class="line">            example_tensor_t *e_t = e_op-&gt;outputs_[j];</div>
<div class="line"> </div>
<div class="line">            <a class="code" href="group__dnnl__graph__api__logical__tensor.html#ga5b552d8a81835eb955253410bf012694">dnnl_graph_layout_type_t</a> layout_type;</div>
<div class="line">            <span class="keywordflow">if</span> (!e_t-&gt;users_num_) {</div>
<div class="line">                <span class="comment">// this is the graph&#39;s output, we set the layout type to plain</span></div>
<div class="line">                layout_type = <a class="code" href="group__dnnl__graph__api__logical__tensor.html#gga5b552d8a81835eb955253410bf012694aa9ea14026cc47aafffdcb92c00a1b1ea">dnnl_graph_layout_type_strided</a>;</div>
<div class="line">            } <span class="keywordflow">else</span> {</div>
<div class="line">                layout_type = <a class="code" href="group__dnnl__graph__api__logical__tensor.html#gga5b552d8a81835eb955253410bf012694afc5178ef75924c4f130c70cf7b223203">dnnl_graph_layout_type_any</a>;</div>
<div class="line">            }</div>
<div class="line">            DNNL_GRAPH_CHECK(<a class="code" href="group__dnnl__graph__api__logical__tensor.html#gad2c645ad00ecc288a830d19cae78dcec">dnnl_graph_logical_tensor_init_with_dims</a>(</div>
<div class="line">                    l_lts_out + j, e_t-&gt;id_,</div>
<div class="line">                    (<a class="code" href="group__dnnl__graph__api__logical__tensor.html#gaad147cf0f6df4b97b1c4a55b5595128b">dnnl_graph_data_type_t</a>)e_t-&gt;dtype_, e_t-&gt;ndims_,</div>
<div class="line">                    e_t-&gt;dims_, layout_type, <a class="code" href="group__dnnl__graph__api__logical__tensor.html#ggadf98ec2238dd9001c6fe7870ebf1b19faa02e5493848853a9bf77982d2fa56ab7">dnnl_graph_tensor_property_undef</a>));</div>
<div class="line">        }</div>
<div class="line"> </div>
<div class="line">        <span class="comment">// compile the partition</span></div>
<div class="line">        <span class="keyword">const</span> <a class="code" href="structdnnl__graph__logical__tensor__t.html">dnnl_graph_logical_tensor_t</a> *l_lts_in_ptr[3];</div>
<div class="line">        <span class="keyword">const</span> <a class="code" href="structdnnl__graph__logical__tensor__t.html">dnnl_graph_logical_tensor_t</a> *l_lts_out_ptr[2];</div>
<div class="line">        <span class="keywordflow">for</span> (<span class="keywordtype">int</span> j = 0; j &lt; e_op-&gt;inputs_num_; j++) {</div>
<div class="line">            l_lts_in_ptr[j] = l_lts_in + j;</div>
<div class="line">        }</div>
<div class="line">        <span class="keywordflow">for</span> (<span class="keywordtype">int</span> j = 0; j &lt; e_op-&gt;outputs_num_; j++) {</div>
<div class="line">            l_lts_out_ptr[j] = l_lts_out + j;</div>
<div class="line">        }</div>
<div class="line"> </div>
<div class="line">        DNNL_GRAPH_CHECK(<a name="a25"></a><a class="code" href="group__dnnl__graph__api__partition.html#gac83bd7f73ce79908254aa98e967b0559">dnnl_graph_partition_compile</a>(partitions[i],</div>
<div class="line">                compiled_partitions[i], e_op-&gt;inputs_num_, l_lts_in_ptr,</div>
<div class="line">                e_op-&gt;outputs_num_, l_lts_out_ptr, engine));</div>
<div class="line"> </div>
<div class="line">        <span class="comment">// partitions are all copied to compiled partition,</span></div>
<div class="line">        <span class="comment">// now we can destroy them safely</span></div>
<div class="line">        DNNL_GRAPH_CHECK(<a name="a26"></a><a class="code" href="group__dnnl__graph__api__partition.html#gabd2c5c87653fd91cc8299d4034d218fa">dnnl_graph_partition_destroy</a>(partitions[i]));</div>
<div class="line">    }</div>
<div class="line">    printf(<span class="stringliteral">&quot;Success!\n&quot;</span>);</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// Step 7: alloc memory for example tensor</span></div>
<div class="line">    <span class="comment">// for opaque tensors, we need to get their actual memory size from compiled partition</span></div>
<div class="line">    printf(<span class="stringliteral">&quot;Step 6: Alloc memory--------------------&quot;</span>);</div>
<div class="line">    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; example_graph-&gt;op_num_; i++) {</div>
<div class="line">        example_op_t *e_op = example_graph-&gt;ops_[i];</div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">if</span> (strcmp(e_op-&gt;name_, <span class="stringliteral">&quot;DNNL_GRAPH_EXE_OP&quot;</span>) != 0) {</div>
<div class="line">            <span class="comment">// this example op is not fake op, it&#39;s input and output memory should be</span></div>
<div class="line">            <span class="comment">// prepared in other ways</span></div>
<div class="line">            <span class="keywordflow">continue</span>;</div>
<div class="line">        }</div>
<div class="line"> </div>
<div class="line">        int64_t idx = find_by_example_op(e_op);</div>
<div class="line">        dnnl_graph_compiled_partition_t *l_cp = p_map[idx].l_cp_;</div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">for</span> (<span class="keywordtype">int</span> j = 0; j &lt; e_op-&gt;inputs_num_; j++) {</div>
<div class="line">            example_tensor_t *e_t = e_op-&gt;inputs_[j];</div>
<div class="line">            <span class="keywordflow">if</span> (e_t-&gt;data_) <span class="keywordflow">continue</span>;</div>
<div class="line"> </div>
<div class="line">            <a class="code" href="structdnnl__graph__logical__tensor__t.html">dnnl_graph_logical_tensor_t</a> temp;</div>
<div class="line">            <span class="keywordtype">size_t</span> mem_size = 0;</div>
<div class="line">            DNNL_GRAPH_CHECK(<a class="code" href="group__dnnl__graph__api__compiled__partition.html#gabb66f2bd97e30ee1578449f4b2f90fe9">dnnl_graph_compiled_partition_query_logical_tensor</a>(</div>
<div class="line">                    l_cp, e_t-&gt;id_, &amp;temp));</div>
<div class="line">            DNNL_GRAPH_CHECK(</div>
<div class="line">                    <a name="a27"></a><a class="code" href="group__dnnl__graph__api__logical__tensor.html#gada423dbef06b45e904dc91951094e252">dnnl_graph_logical_tensor_get_mem_size</a>(&amp;temp, &amp;mem_size));</div>
<div class="line">            <span class="keywordflow">if</span> (mem_size == 0 || mem_size == (<span class="keywordtype">size_t</span>)-1) { <span class="keywordflow">continue</span>; }</div>
<div class="line">            e_t-&gt;data_ = malloc(mem_size);</div>
<div class="line">        }</div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">for</span> (<span class="keywordtype">int</span> j = 0; j &lt; e_op-&gt;outputs_num_; j++) {</div>
<div class="line">            example_tensor_t *e_t = e_op-&gt;outputs_[j];</div>
<div class="line">            <span class="keywordflow">if</span> (e_t-&gt;data_) <span class="keywordflow">continue</span>;</div>
<div class="line"> </div>
<div class="line">            <a class="code" href="structdnnl__graph__logical__tensor__t.html">dnnl_graph_logical_tensor_t</a> temp;</div>
<div class="line">            <span class="keywordtype">size_t</span> mem_size = 0;</div>
<div class="line">            DNNL_GRAPH_CHECK(<a class="code" href="group__dnnl__graph__api__compiled__partition.html#gabb66f2bd97e30ee1578449f4b2f90fe9">dnnl_graph_compiled_partition_query_logical_tensor</a>(</div>
<div class="line">                    l_cp, e_t-&gt;id_, &amp;temp));</div>
<div class="line">            DNNL_GRAPH_CHECK(</div>
<div class="line">                    <a class="code" href="group__dnnl__graph__api__logical__tensor.html#gada423dbef06b45e904dc91951094e252">dnnl_graph_logical_tensor_get_mem_size</a>(&amp;temp, &amp;mem_size));</div>
<div class="line">            <span class="keywordflow">if</span> (mem_size == 0 || mem_size == (<span class="keywordtype">size_t</span>)-1) { <span class="keywordflow">continue</span>; }</div>
<div class="line">            e_t-&gt;data_ = malloc(mem_size);</div>
<div class="line">        }</div>
<div class="line">    }</div>
<div class="line">    printf(<span class="stringliteral">&quot;Success!\n&quot;</span>);</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// Step 8: Execute compiled partitions</span></div>
<div class="line">    printf(<span class="stringliteral">&quot;Step 7: Execute compiled partitions-----&quot;</span>);</div>
<div class="line">    dnnl_graph_stream_t *stream = NULL;</div>
<div class="line">    DNNL_GRAPH_CHECK(<a name="a28"></a><a class="code" href="group__dnnl__graph__api__stream.html#ga9c7b4e3da3ff11defad596b68a389d6a">dnnl_graph_stream_create</a>(&amp;stream, engine));</div>
<div class="line">    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; example_graph-&gt;op_num_; i++) {</div>
<div class="line">        example_op_t *e_op = example_graph-&gt;ops_[i];</div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">if</span> (strcmp(e_op-&gt;name_, <span class="stringliteral">&quot;DNNL_GRAPH_EXE_OP&quot;</span>) != 0) {</div>
<div class="line">            <span class="comment">// this example op is not a fake op, need to be executed</span></div>
<div class="line">            <span class="comment">// in other ways</span></div>
<div class="line">            <span class="keywordflow">continue</span>;</div>
<div class="line">        }</div>
<div class="line"> </div>
<div class="line">        int64_t idx = find_by_example_op(e_op);</div>
<div class="line">        dnnl_graph_compiled_partition_t *l_cp = p_map[idx].l_cp_;</div>
<div class="line"> </div>
<div class="line">        dnnl_graph_tensor_t *l_ts_in[3];</div>
<div class="line">        <span class="keywordflow">for</span> (<span class="keywordtype">int</span> j = 0; j &lt; e_op-&gt;inputs_num_; j++) {</div>
<div class="line">            example_tensor_t *e_t = e_op-&gt;inputs_[j];</div>
<div class="line"> </div>
<div class="line">            <a class="code" href="structdnnl__graph__logical__tensor__t.html">dnnl_graph_logical_tensor_t</a> l_lt;</div>
<div class="line">            DNNL_GRAPH_CHECK(<a class="code" href="group__dnnl__graph__api__compiled__partition.html#gabb66f2bd97e30ee1578449f4b2f90fe9">dnnl_graph_compiled_partition_query_logical_tensor</a>(</div>
<div class="line">                    l_cp, e_t-&gt;id_, &amp;l_lt));</div>
<div class="line"> </div>
<div class="line">            DNNL_GRAPH_CHECK(<a name="a29"></a><a class="code" href="group__dnnl__graph__api__tensor.html#ga83ec5b0beb4cd0efa82903c6f72421a6">dnnl_graph_tensor_create</a>(</div>
<div class="line">                    &amp;l_ts_in[j], &amp;l_lt, engine, e_t-&gt;data_));</div>
<div class="line">        }</div>
<div class="line"> </div>
<div class="line">        dnnl_graph_tensor_t *l_ts_out[2];</div>
<div class="line">        <span class="keywordflow">for</span> (<span class="keywordtype">int</span> j = 0; j &lt; e_op-&gt;outputs_num_; j++) {</div>
<div class="line">            example_tensor_t *e_t = e_op-&gt;outputs_[j];</div>
<div class="line"> </div>
<div class="line">            <a class="code" href="structdnnl__graph__logical__tensor__t.html">dnnl_graph_logical_tensor_t</a> l_lt;</div>
<div class="line">            DNNL_GRAPH_CHECK(<a class="code" href="group__dnnl__graph__api__compiled__partition.html#gabb66f2bd97e30ee1578449f4b2f90fe9">dnnl_graph_compiled_partition_query_logical_tensor</a>(</div>
<div class="line">                    l_cp, e_t-&gt;id_, &amp;l_lt));</div>
<div class="line"> </div>
<div class="line">            DNNL_GRAPH_CHECK(<a class="code" href="group__dnnl__graph__api__tensor.html#ga83ec5b0beb4cd0efa82903c6f72421a6">dnnl_graph_tensor_create</a>(</div>
<div class="line">                    &amp;l_ts_out[j], &amp;l_lt, engine, e_t-&gt;data_));</div>
<div class="line">        }</div>
<div class="line"> </div>
<div class="line">        <span class="comment">// execute the compiled partition</span></div>
<div class="line">        DNNL_GRAPH_CHECK(<a name="a30"></a><a class="code" href="group__dnnl__graph__api__compiled__partition.html#ga894a56f124c890241eeb060be09383cf">dnnl_graph_compiled_partition_execute</a>(l_cp, stream,</div>
<div class="line">                e_op-&gt;inputs_num_, (<span class="keyword">const</span> dnnl_graph_tensor_t **)l_ts_in,</div>
<div class="line">                e_op-&gt;outputs_num_, (<span class="keyword">const</span> dnnl_graph_tensor_t **)l_ts_out));</div>
<div class="line"> </div>
<div class="line">        <span class="comment">// destroy tensor, which will not free data_ memory</span></div>
<div class="line">        <span class="keywordflow">for</span> (<span class="keywordtype">int</span> j = 0; j &lt; e_op-&gt;inputs_num_; j++) {</div>
<div class="line">            DNNL_GRAPH_CHECK(<a name="a31"></a><a class="code" href="group__dnnl__graph__api__tensor.html#ga60be2b5676853581a130eea7f43bc506">dnnl_graph_tensor_destroy</a>(l_ts_in[j]));</div>
<div class="line">        }</div>
<div class="line">        <span class="keywordflow">for</span> (<span class="keywordtype">int</span> j = 0; j &lt; e_op-&gt;outputs_num_; j++) {</div>
<div class="line">            DNNL_GRAPH_CHECK(<a class="code" href="group__dnnl__graph__api__tensor.html#ga60be2b5676853581a130eea7f43bc506">dnnl_graph_tensor_destroy</a>(l_ts_out[j]));</div>
<div class="line">        }</div>
<div class="line">    }</div>
<div class="line">    DNNL_GRAPH_CHECK(<a name="a32"></a><a class="code" href="group__dnnl__graph__api__stream.html#gae81389e653c36d37a9c3b8ea6fd6d7c8">dnnl_graph_stream_destroy</a>(stream));</div>
<div class="line">    printf(<span class="stringliteral">&quot;Success!\n&quot;</span>);</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// release resource</span></div>
<div class="line">    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; partitions_num; i++) {</div>
<div class="line">        DNNL_GRAPH_CHECK(</div>
<div class="line">                <a name="a33"></a><a class="code" href="group__dnnl__graph__api__compiled__partition.html#gadb5bacd35a4fc599fd53b10a3d1e53a6">dnnl_graph_compiled_partition_destroy</a>(compiled_partitions[i]));</div>
<div class="line">    }</div>
<div class="line">    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; o_map_num; i++) {</div>
<div class="line">        DNNL_GRAPH_CHECK(<a name="a34"></a><a class="code" href="group__dnnl__graph__api__op.html#gac0387fba6a462049a3edf9a944b8ceba">dnnl_graph_op_destroy</a>(o_map[i].dnnl_graph_op_));</div>
<div class="line">    }</div>
<div class="line">    example_graph_destroy(example_graph);</div>
<div class="line">    example_tensor_destroy_all();</div>
<div class="line">    DNNL_GRAPH_CHECK(<a class="code" href="group__dnnl__graph__api__graph.html#ga81b728dd786b54ad00ae27c653fda997">dnnl_graph_graph_destroy</a>(graph));</div>
<div class="line">    DNNL_GRAPH_CHECK(<a class="code" href="group__dnnl__graph__api__engine.html#ga902b3342c537e89283590657ab2b532d">dnnl_graph_engine_destroy</a>(engine));</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">return</span> 0;</div>
<div class="line">}</div>
<div class="ttc" id="adnnl__graph_8h_html"><div class="ttname"><a href="dnnl__graph_8h.html">dnnl_graph.h</a></div><div class="ttdoc">C API.</div></div>
<div class="ttc" id="agroup__dnnl__graph__api__compiled__partition_html_ga6195715f5461f59b5f7e0b81c94d8ad6"><div class="ttname"><a href="group__dnnl__graph__api__compiled__partition.html#ga6195715f5461f59b5f7e0b81c94d8ad6">dnnl_graph_compiled_partition_create</a></div><div class="ttdeci">dnnl_graph_result_t DNNL_GRAPH_API dnnl_graph_compiled_partition_create(dnnl_graph_compiled_partition_t **compiled_partition, dnnl_graph_partition_t *partition)</div><div class="ttdoc">Creates a new compiled partition.</div></div>
<div class="ttc" id="agroup__dnnl__graph__api__compiled__partition_html_ga894a56f124c890241eeb060be09383cf"><div class="ttname"><a href="group__dnnl__graph__api__compiled__partition.html#ga894a56f124c890241eeb060be09383cf">dnnl_graph_compiled_partition_execute</a></div><div class="ttdeci">dnnl_graph_result_t DNNL_GRAPH_API dnnl_graph_compiled_partition_execute(const dnnl_graph_compiled_partition_t *compiled_partition, const dnnl_graph_stream_t *stream, const uint64_t num_inputs, const dnnl_graph_tensor_t **inputs, const uint64_t num_outputs, const dnnl_graph_tensor_t **outputs)</div><div class="ttdoc">Execute a compiled partition.</div></div>
<div class="ttc" id="agroup__dnnl__graph__api__compiled__partition_html_gabb66f2bd97e30ee1578449f4b2f90fe9"><div class="ttname"><a href="group__dnnl__graph__api__compiled__partition.html#gabb66f2bd97e30ee1578449f4b2f90fe9">dnnl_graph_compiled_partition_query_logical_tensor</a></div><div class="ttdeci">dnnl_graph_result_t DNNL_GRAPH_API dnnl_graph_compiled_partition_query_logical_tensor(const dnnl_graph_compiled_partition_t *compiled_partition, size_t tid, dnnl_graph_logical_tensor_t *lt)</div><div class="ttdoc">Returns the logical tensor according to tensor id.</div></div>
<div class="ttc" id="agroup__dnnl__graph__api__compiled__partition_html_gadb5bacd35a4fc599fd53b10a3d1e53a6"><div class="ttname"><a href="group__dnnl__graph__api__compiled__partition.html#gadb5bacd35a4fc599fd53b10a3d1e53a6">dnnl_graph_compiled_partition_destroy</a></div><div class="ttdeci">dnnl_graph_result_t DNNL_GRAPH_API dnnl_graph_compiled_partition_destroy(dnnl_graph_compiled_partition_t *compiled_partition)</div><div class="ttdoc">Destroy the target compiled partition.</div></div>
<div class="ttc" id="agroup__dnnl__graph__api__engine_html_ga6ac1ba87052e33099253f1d21ddd0091"><div class="ttname"><a href="group__dnnl__graph__api__engine.html#ga6ac1ba87052e33099253f1d21ddd0091">dnnl_graph_engine_kind_t</a></div><div class="ttdeci">dnnl_graph_engine_kind_t</div><div class="ttdoc">Kind for engine.</div><div class="ttdef"><b>Definition:</b> dnnl_graph_types.h:156</div></div>
<div class="ttc" id="agroup__dnnl__graph__api__engine_html_ga902b3342c537e89283590657ab2b532d"><div class="ttname"><a href="group__dnnl__graph__api__engine.html#ga902b3342c537e89283590657ab2b532d">dnnl_graph_engine_destroy</a></div><div class="ttdeci">dnnl_graph_result_t DNNL_GRAPH_API dnnl_graph_engine_destroy(dnnl_graph_engine_t *engine)</div><div class="ttdoc">Destroy the target engine.</div></div>
<div class="ttc" id="agroup__dnnl__graph__api__engine_html_gaffbc76b0e5aaa1683475940224c7da2b"><div class="ttname"><a href="group__dnnl__graph__api__engine.html#gaffbc76b0e5aaa1683475940224c7da2b">dnnl_graph_engine_create</a></div><div class="ttdeci">dnnl_graph_result_t DNNL_GRAPH_API dnnl_graph_engine_create(dnnl_graph_engine_t **created_engine, dnnl_graph_engine_kind_t engine_kind, int32_t device_id)</div><div class="ttdoc">Creates an engine with specified engine kind and device id.</div></div>
<div class="ttc" id="agroup__dnnl__graph__api__engine_html_gga6ac1ba87052e33099253f1d21ddd0091a0e4015e41880cfeee945c30cbf346da2"><div class="ttname"><a href="group__dnnl__graph__api__engine.html#gga6ac1ba87052e33099253f1d21ddd0091a0e4015e41880cfeee945c30cbf346da2">dnnl_graph_gpu</a></div><div class="ttdeci">@ dnnl_graph_gpu</div><div class="ttdoc">GPU engine.</div><div class="ttdef"><b>Definition:</b> dnnl_graph_types.h:162</div></div>
<div class="ttc" id="agroup__dnnl__graph__api__graph_html_ga27e4c096e75702ef2a885c2cecd64d12"><div class="ttname"><a href="group__dnnl__graph__api__graph.html#ga27e4c096e75702ef2a885c2cecd64d12">dnnl_graph_graph_filter</a></div><div class="ttdeci">dnnl_graph_result_t DNNL_GRAPH_API dnnl_graph_graph_filter(dnnl_graph_graph_t *graph, dnnl_graph_partition_policy_t policy)</div><div class="ttdoc">Do graph filtering and partitioning.</div></div>
<div class="ttc" id="agroup__dnnl__graph__api__graph_html_ga46e3946d6079590f03205f660be1b5fe"><div class="ttname"><a href="group__dnnl__graph__api__graph.html#ga46e3946d6079590f03205f660be1b5fe">dnnl_graph_add_op</a></div><div class="ttdeci">dnnl_graph_result_t DNNL_GRAPH_API dnnl_graph_add_op(dnnl_graph_graph_t *graph, dnnl_graph_op_t *op)</div><div class="ttdoc">Add a new op to a graph.</div></div>
<div class="ttc" id="agroup__dnnl__graph__api__graph_html_ga81b728dd786b54ad00ae27c653fda997"><div class="ttname"><a href="group__dnnl__graph__api__graph.html#ga81b728dd786b54ad00ae27c653fda997">dnnl_graph_graph_destroy</a></div><div class="ttdeci">dnnl_graph_result_t DNNL_GRAPH_API dnnl_graph_graph_destroy(dnnl_graph_graph_t *graph)</div><div class="ttdoc">Destroy the target graph.</div></div>
<div class="ttc" id="agroup__dnnl__graph__api__graph_html_gab0799273b35e51deb13ebaf510124a8b"><div class="ttname"><a href="group__dnnl__graph__api__graph.html#gab0799273b35e51deb13ebaf510124a8b">dnnl_graph_graph_get_partition_num</a></div><div class="ttdeci">dnnl_graph_result_t DNNL_GRAPH_API dnnl_graph_graph_get_partition_num(const dnnl_graph_graph_t *graph, uint64_t *num)</div><div class="ttdoc">Gets the number of partitions of the graph.</div></div>
<div class="ttc" id="agroup__dnnl__graph__api__graph_html_gadfe53f5827f6a1b22c6a3d379b229af9"><div class="ttname"><a href="group__dnnl__graph__api__graph.html#gadfe53f5827f6a1b22c6a3d379b229af9">dnnl_graph_graph_create</a></div><div class="ttdeci">dnnl_graph_result_t DNNL_GRAPH_API dnnl_graph_graph_create(dnnl_graph_graph_t **created_graph, dnnl_graph_engine_kind_t device_type)</div><div class="ttdoc">Creates a new empty graph.</div></div>
<div class="ttc" id="agroup__dnnl__graph__api__graph_html_gaf5c2c8684ac48acc413fb9cfbe699c60"><div class="ttname"><a href="group__dnnl__graph__api__graph.html#gaf5c2c8684ac48acc413fb9cfbe699c60">dnnl_graph_graph_get_partitions</a></div><div class="ttdeci">dnnl_graph_result_t DNNL_GRAPH_API dnnl_graph_graph_get_partitions(dnnl_graph_graph_t *graph, uint64_t num, dnnl_graph_partition_t **partition)</div><div class="ttdoc">Gets the filtered partitions of the graph.</div></div>
<div class="ttc" id="agroup__dnnl__graph__api__logical__tensor_html_ga5b552d8a81835eb955253410bf012694"><div class="ttname"><a href="group__dnnl__graph__api__logical__tensor.html#ga5b552d8a81835eb955253410bf012694">dnnl_graph_layout_type_t</a></div><div class="ttdeci">dnnl_graph_layout_type_t</div><div class="ttdoc">Layout type specification.</div><div class="ttdef"><b>Definition:</b> dnnl_graph_types.h:234</div></div>
<div class="ttc" id="agroup__dnnl__graph__api__logical__tensor_html_gaad147cf0f6df4b97b1c4a55b5595128b"><div class="ttname"><a href="group__dnnl__graph__api__logical__tensor.html#gaad147cf0f6df4b97b1c4a55b5595128b">dnnl_graph_data_type_t</a></div><div class="ttdeci">dnnl_graph_data_type_t</div><div class="ttdoc">Data type specifications.</div><div class="ttdef"><b>Definition:</b> dnnl_graph_types.h:71</div></div>
<div class="ttc" id="agroup__dnnl__graph__api__logical__tensor_html_gad2c645ad00ecc288a830d19cae78dcec"><div class="ttname"><a href="group__dnnl__graph__api__logical__tensor.html#gad2c645ad00ecc288a830d19cae78dcec">dnnl_graph_logical_tensor_init_with_dims</a></div><div class="ttdeci">dnnl_graph_result_t DNNL_GRAPH_API dnnl_graph_logical_tensor_init_with_dims(dnnl_graph_logical_tensor_t *created_logical_tensor, size_t tid, dnnl_graph_data_type_t dtype, int32_t ndims, const dnnl_graph_dims_t dims, dnnl_graph_layout_type_t ltype, dnnl_graph_tensor_property_t ptype)</div><div class="ttdoc">Initializes a logical tensor with basic information, dims, and property.</div></div>
<div class="ttc" id="agroup__dnnl__graph__api__logical__tensor_html_gada423dbef06b45e904dc91951094e252"><div class="ttname"><a href="group__dnnl__graph__api__logical__tensor.html#gada423dbef06b45e904dc91951094e252">dnnl_graph_logical_tensor_get_mem_size</a></div><div class="ttdeci">dnnl_graph_result_t DNNL_GRAPH_API dnnl_graph_logical_tensor_get_mem_size(const dnnl_graph_logical_tensor_t *logical_tensor, size_t *size)</div><div class="ttdoc">Returns the memory size described by the logical tensor.</div></div>
<div class="ttc" id="agroup__dnnl__graph__api__logical__tensor_html_gga5b552d8a81835eb955253410bf012694aa9ea14026cc47aafffdcb92c00a1b1ea"><div class="ttname"><a href="group__dnnl__graph__api__logical__tensor.html#gga5b552d8a81835eb955253410bf012694aa9ea14026cc47aafffdcb92c00a1b1ea">dnnl_graph_layout_type_strided</a></div><div class="ttdeci">@ dnnl_graph_layout_type_strided</div><div class="ttdoc">strided means that the layout is determined by the strides field.</div><div class="ttdef"><b>Definition:</b> dnnl_graph_types.h:241</div></div>
<div class="ttc" id="agroup__dnnl__graph__api__logical__tensor_html_gga5b552d8a81835eb955253410bf012694afc5178ef75924c4f130c70cf7b223203"><div class="ttname"><a href="group__dnnl__graph__api__logical__tensor.html#gga5b552d8a81835eb955253410bf012694afc5178ef75924c4f130c70cf7b223203">dnnl_graph_layout_type_any</a></div><div class="ttdeci">@ dnnl_graph_layout_type_any</div><div class="ttdoc">any means that oneDNN graph implementation needs to decide the layout for the compiled partition.</div><div class="ttdef"><b>Definition:</b> dnnl_graph_types.h:239</div></div>
<div class="ttc" id="agroup__dnnl__graph__api__logical__tensor_html_ggadf98ec2238dd9001c6fe7870ebf1b19faa02e5493848853a9bf77982d2fa56ab7"><div class="ttname"><a href="group__dnnl__graph__api__logical__tensor.html#ggadf98ec2238dd9001c6fe7870ebf1b19faa02e5493848853a9bf77982d2fa56ab7">dnnl_graph_tensor_property_undef</a></div><div class="ttdeci">@ dnnl_graph_tensor_property_undef</div><div class="ttdoc">undefined tensor property</div><div class="ttdef"><b>Definition:</b> dnnl_graph_types.h:250</div></div>
<div class="ttc" id="agroup__dnnl__graph__api__op_html_ga057fa366160206d52e4dbd05443a8b01"><div class="ttname"><a href="group__dnnl__graph__api__op.html#ga057fa366160206d52e4dbd05443a8b01">dnnl_graph_op_get_id</a></div><div class="ttdeci">dnnl_graph_result_t DNNL_GRAPH_API dnnl_graph_op_get_id(const dnnl_graph_op_t *op, size_t *id)</div><div class="ttdoc">Returns the unique id of the Op.</div></div>
<div class="ttc" id="agroup__dnnl__graph__api__op_html_ga56fcbd336ee8259ef768a78ac21387ef"><div class="ttname"><a href="group__dnnl__graph__api__op.html#ga56fcbd336ee8259ef768a78ac21387ef">dnnl_graph_attribute_kind_t</a></div><div class="ttdeci">dnnl_graph_attribute_kind_t</div><div class="ttdoc">Kind for op's attributes.</div><div class="ttdef"><b>Definition:</b> dnnl_graph_types.h:180</div></div>
<div class="ttc" id="agroup__dnnl__graph__api__op_html_ga862fb0704b7712f99ec60d7a9c4a70ac"><div class="ttname"><a href="group__dnnl__graph__api__op.html#ga862fb0704b7712f99ec60d7a9c4a70ac">dnnl_graph_op_add_attr</a></div><div class="ttdeci">dnnl_graph_result_t DNNL_GRAPH_API dnnl_graph_op_add_attr(dnnl_graph_op_t *op, const char *name, dnnl_graph_attribute_kind_t kind, const void *attr, int64_t attr_no)</div><div class="ttdoc">Sets the attribute according to the name and kind.</div></div>
<div class="ttc" id="agroup__dnnl__graph__api__op_html_gaa04492222b1da2e74ed6c8e0e13d7ea3"><div class="ttname"><a href="group__dnnl__graph__api__op.html#gaa04492222b1da2e74ed6c8e0e13d7ea3">dnnl_graph_op_create</a></div><div class="ttdeci">dnnl_graph_result_t DNNL_GRAPH_API dnnl_graph_op_create(dnnl_graph_op_t **created_op, uint64_t id, dnnl_graph_op_kind_t kind, const char *const debug_string)</div><div class="ttdoc">Initializes an op with unique id, kind and debug string.</div></div>
<div class="ttc" id="agroup__dnnl__graph__api__op_html_gac0387fba6a462049a3edf9a944b8ceba"><div class="ttname"><a href="group__dnnl__graph__api__op.html#gac0387fba6a462049a3edf9a944b8ceba">dnnl_graph_op_destroy</a></div><div class="ttdeci">dnnl_graph_result_t DNNL_GRAPH_API dnnl_graph_op_destroy(dnnl_graph_op_t *op)</div><div class="ttdoc">Destroys the created op.</div></div>
<div class="ttc" id="agroup__dnnl__graph__api__op_html_gac4e6257c11f83655f5a75dd538f16938"><div class="ttname"><a href="group__dnnl__graph__api__op.html#gac4e6257c11f83655f5a75dd538f16938">dnnl_graph_op_add_input</a></div><div class="ttdeci">dnnl_graph_result_t DNNL_GRAPH_API dnnl_graph_op_add_input(dnnl_graph_op_t *op, const dnnl_graph_logical_tensor_t *input)</div><div class="ttdoc">Adds input logical tensor to the op.</div></div>
<div class="ttc" id="agroup__dnnl__graph__api__op_html_gaf57b836c94bc9974da2da67a0a68baf2"><div class="ttname"><a href="group__dnnl__graph__api__op.html#gaf57b836c94bc9974da2da67a0a68baf2">dnnl_graph_op_add_output</a></div><div class="ttdeci">dnnl_graph_result_t DNNL_GRAPH_API dnnl_graph_op_add_output(dnnl_graph_op_t *op, const dnnl_graph_logical_tensor_t *output)</div><div class="ttdoc">Adds output logical tensor to the op.</div></div>
<div class="ttc" id="agroup__dnnl__graph__api__partition_html_ga35581ae03ac8606c1bcb52e4c6ee8d8a"><div class="ttname"><a href="group__dnnl__graph__api__partition.html#ga35581ae03ac8606c1bcb52e4c6ee8d8a">dnnl_graph_partition_get_ops</a></div><div class="ttdeci">dnnl_graph_result_t DNNL_GRAPH_API dnnl_graph_partition_get_ops(dnnl_graph_partition_t *partition, size_t num, size_t *ids)</div><div class="ttdoc">Returns the list of op IDs of the partition.</div></div>
<div class="ttc" id="agroup__dnnl__graph__api__partition_html_gabd2c5c87653fd91cc8299d4034d218fa"><div class="ttname"><a href="group__dnnl__graph__api__partition.html#gabd2c5c87653fd91cc8299d4034d218fa">dnnl_graph_partition_destroy</a></div><div class="ttdeci">dnnl_graph_result_t DNNL_GRAPH_API dnnl_graph_partition_destroy(dnnl_graph_partition_t *partition)</div><div class="ttdoc">Destroy the target partition.</div></div>
<div class="ttc" id="agroup__dnnl__graph__api__partition_html_gabdd1e8735d0f2f72165da4c2458121e0"><div class="ttname"><a href="group__dnnl__graph__api__partition.html#gabdd1e8735d0f2f72165da4c2458121e0">dnnl_graph_partition_create</a></div><div class="ttdeci">dnnl_graph_result_t DNNL_GRAPH_API dnnl_graph_partition_create(dnnl_graph_partition_t **partition)</div><div class="ttdoc">Creates a new empty partition.</div></div>
<div class="ttc" id="agroup__dnnl__graph__api__partition_html_gac83bd7f73ce79908254aa98e967b0559"><div class="ttname"><a href="group__dnnl__graph__api__partition.html#gac83bd7f73ce79908254aa98e967b0559">dnnl_graph_partition_compile</a></div><div class="ttdeci">dnnl_graph_result_t DNNL_GRAPH_API dnnl_graph_partition_compile(dnnl_graph_partition_t *partition, dnnl_graph_compiled_partition_t *compiled_partition, uint64_t in_num, const dnnl_graph_logical_tensor_t **inputs, uint64_t out_num, const dnnl_graph_logical_tensor_t **outputs, const dnnl_graph_engine_t *engine)</div><div class="ttdoc">Compile the partition with given input and output logical tensors.</div></div>
<div class="ttc" id="agroup__dnnl__graph__api__partition_html_gae377c7c97821f6ee0f30fe629ba30d88"><div class="ttname"><a href="group__dnnl__graph__api__partition.html#gae377c7c97821f6ee0f30fe629ba30d88">dnnl_graph_partition_get_op_num</a></div><div class="ttdeci">dnnl_graph_result_t DNNL_GRAPH_API dnnl_graph_partition_get_op_num(const dnnl_graph_partition_t *partition, size_t *num)</div><div class="ttdoc">Returns the number of ops of the partition.</div></div>
<div class="ttc" id="agroup__dnnl__graph__api__partition_html_gga7e24b277b64600ef3a83dac2e8dfa83ba1489f3f9bb1262b58fa0bf0524d883a4"><div class="ttname"><a href="group__dnnl__graph__api__partition.html#gga7e24b277b64600ef3a83dac2e8dfa83ba1489f3f9bb1262b58fa0bf0524d883a4">dnnl_graph_partition_policy_fusion</a></div><div class="ttdeci">@ dnnl_graph_partition_policy_fusion</div><div class="ttdoc">Have fusion.</div><div class="ttdef"><b>Definition:</b> dnnl_graph_types.h:98</div></div>
<div class="ttc" id="agroup__dnnl__graph__api__stream_html_ga9c7b4e3da3ff11defad596b68a389d6a"><div class="ttname"><a href="group__dnnl__graph__api__stream.html#ga9c7b4e3da3ff11defad596b68a389d6a">dnnl_graph_stream_create</a></div><div class="ttdeci">dnnl_graph_result_t DNNL_GRAPH_API dnnl_graph_stream_create(dnnl_graph_stream_t **created_stream, const dnnl_graph_engine_t *engine)</div><div class="ttdoc">Creates a stream for the specified engine.</div></div>
<div class="ttc" id="agroup__dnnl__graph__api__stream_html_gae81389e653c36d37a9c3b8ea6fd6d7c8"><div class="ttname"><a href="group__dnnl__graph__api__stream.html#gae81389e653c36d37a9c3b8ea6fd6d7c8">dnnl_graph_stream_destroy</a></div><div class="ttdeci">dnnl_graph_result_t DNNL_GRAPH_API dnnl_graph_stream_destroy(dnnl_graph_stream_t *stream)</div><div class="ttdoc">Destroy the target stream.</div></div>
<div class="ttc" id="agroup__dnnl__graph__api__tensor_html_ga60be2b5676853581a130eea7f43bc506"><div class="ttname"><a href="group__dnnl__graph__api__tensor.html#ga60be2b5676853581a130eea7f43bc506">dnnl_graph_tensor_destroy</a></div><div class="ttdeci">dnnl_graph_result_t DNNL_GRAPH_API dnnl_graph_tensor_destroy(dnnl_graph_tensor_t *tensor)</div><div class="ttdoc">Destroys the created tensor.</div></div>
<div class="ttc" id="agroup__dnnl__graph__api__tensor_html_ga83ec5b0beb4cd0efa82903c6f72421a6"><div class="ttname"><a href="group__dnnl__graph__api__tensor.html#ga83ec5b0beb4cd0efa82903c6f72421a6">dnnl_graph_tensor_create</a></div><div class="ttdeci">dnnl_graph_result_t DNNL_GRAPH_API dnnl_graph_tensor_create(dnnl_graph_tensor_t **tensor, const dnnl_graph_logical_tensor_t *logical_tensor, const dnnl_graph_engine_t *engine, void *handle)</div><div class="ttdoc">Initializes a tensor with logical tensor, engine, and data handle.</div></div>
<div class="ttc" id="astructdnnl__graph__logical__tensor__t_html"><div class="ttname"><a href="structdnnl__graph__logical__tensor__t.html">dnnl_graph_logical_tensor_t</a></div><div class="ttdoc">logical tensor definition</div><div class="ttdef"><b>Definition:</b> dnnl_graph_types.h:258</div></div>
</div><!-- fragment --> </div><!-- contents -->
</div><!-- doc-content -->
<div class="footer">
    <script>
        $('#top').prependTo($('#side-nav'));
    </script>
    <div class="footer-wrapper">
        <hr>
        <ul class="footer-links">
            <li><a href="legal_information.html">Legal information</a></li>
        </ul>
    </div>
</div>